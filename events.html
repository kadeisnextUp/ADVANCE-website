<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Events</title>

  <!-- Keep global files -->
  <link rel="stylesheet" href="style.css" />
  <script src="events-data.js" defer></script>
  <script src="script.js" defer></script>
  <script src="https://cdn.lordicon.com/lordicon.js" defer></script>

  <!-- Page-scope styles live in style.css (at the end).
       Nothing else needed here. -->
</head>

<body class="page-events">
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand-logos">
        <a href="index.html" class="brand" aria-label="ADVANCE home">
          <img src="images/Logos/ADVANCE new logo.png" alt="ADVANCE logo" />
        </a>
        <a href="https://www.uc.edu" class="partner" aria-label="University of Cincinnati" target="_blank" rel="noopener">
          <img src="images/Logos/university_of_cincinnati_logo.svg" alt="UC Logo" />
        </a>
      </div>

      <button class="nav-toggle" aria-expanded="false" aria-label="Toggle navigation">
        <span class="hamburger" aria-hidden="true"></span>
      </button>

      <nav class="site-nav" aria-label="Main Navigation">
        <ul>
          <li><a href="about.html">About</a></li>
          <li><a href="join.html">Join</a></li>
          <li><a href="events.html" class="active" aria-current="page">Events</a></li>
          <li><a href="executiveBoard.html">Executive Board</a></li>
          <li><a href="sponsors.html">Sponsors</a></li>
          <li><a href="resources.html">Resources</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Banner / marquee -->
  <div class="banner" role="region" aria-label="Site banner">
    <div class="marquee" aria-hidden="true">
      <div class="marquee__inner">
        <span class="marquee__item">ADVANCE — Where We Are Paving The Way For Tomorrow's Leaders!!!</span>
        <span class="marquee__item">ADVANCE — Where We Are Paving The Way For Tomorrow's Leaders!!!</span>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <main class="events-wrap">
    <div class="container">
      <header class="events-hero">
        <h1>Events</h1>
        <p class="events-sub">Upcoming and recent happenings — grouped by month</p>
      </header>

      <!-- Featured “Next Up” mini-carousel -->
      <section class="ev-featured" aria-label="Next up">
        <div class="ev-featured-card" id="evFeaturedCard">
          <div class="ev-featured-media">
            <img alt="" />
          </div>
          <div class="ev-featured-meta">
            <span class="ev-pill" id="evFeaturedDate">TBA</span>
            <h3 id="evFeaturedTitle">Event</h3>
            <p id="evFeaturedDesc">Details coming soon.</p>
            <div class="ev-featured-actions">
              <button class="ev-btn" id="evPrev" aria-label="Previous event">‹</button>
              <button class="ev-btn" id="evNext" aria-label="Next event">›</button>
              <a class="ev-btn ev-btn-link" href="#ev-groups">More events</a>
            </div>
          </div>
        </div>
      </section>

      <!-- Month groups (rendered by JS) -->
      <section id="ev-groups" class="events-groups" aria-label="Events grouped by month">
        <noscript>Enable JavaScript to view events.</noscript>
      </section>
    </div>
  </main>

  <!-- Lightbox (reuses your existing styles) -->
  <div class="ev-lightbox" id="evLightbox" aria-hidden="true">
    <button class="ev-lightbox-close" aria-label="Close" data-ev-close>&times;</button>
    <img class="ev-lightbox-img" alt="" />
    <p class="ev-lightbox-cap"></p>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 ADVANCE. All rights reserved.</p>
    <div class="social-links">
      <a href="https://facebook.com/advance" target="_blank" rel="noopener" aria-label="Facebook">
        <lord-icon src="https://cdn.lordicon.com/cxauoejw.json" trigger="hover" colors="primary:#000000,secondary:#ffd700" style="width:40px;height:40px"></lord-icon>
      </a>
      <a href="https://www.tiktok.com/@advance" target="_blank" rel="noopener" aria-label="TikTok">
        <lord-icon src="https://cdn.lordicon.com/opjtxtkg.json" trigger="hover" colors="primary:#000000,secondary:#ffd700" style="width:40px;height:40px"></lord-icon>
      </a>
      <a href="https://instagram.com/advance_uc" target="_blank" rel="noopener" aria-label="Instagram">
        <lord-icon src="https://cdn.lordicon.com/cuwcpyqc.json" trigger="hover" colors="primary:#000000,secondary:#ffd700" style="width:40px;height:40px"></lord-icon>
      </a>
    </div>
  </footer>

  <!-- ===== Events grid renderer (same logic as you had, compact) ===== -->
  <script>
    (function () {
      const mount = document.querySelector('.events-groups');
      if (!mount) return;

      const data = Array.isArray(window.EVENTS) ? window.EVENTS.slice() : [];

      const toISO = (d)=>{
        if(!d) return null;
        if(/^\d{4}-\d{2}-\d{2}$/.test(d)) return d;
        const t = new Date(d);
        if(isNaN(t)) return null;
        const y=t.getFullYear(), m=String(t.getMonth()+1).padStart(2,'0'), dd=String(t.getDate()).padStart(2,'0');
        return `${y}-${m}-${dd}`;
      };

      data.forEach(e=>{ e._iso = toISO(e.date); e._month = e._iso ? e._iso.slice(0,7) : 'TBA'; });
      data.sort((a,b)=>{ if(!a._iso && !b._iso) return 0; if(!a._iso) return 1; if(!b._iso) return -1; return a._iso.localeCompare(b._iso); });

      const groups = {};
      for(const e of data){ (groups[e._month] ||= []).push(e); }

      const monthLabel = (key)=>{
        if(key==='TBA') return 'TBA';
        const [y,m]=key.split('-').map(Number);
        const d = new Date(y, m-1, 1);
        return d.toLocaleString(undefined, {month:'long', year:'numeric'});
      };

      mount.innerHTML = '';
      const frag = document.createDocumentFragment();

      Object.keys(groups).forEach((key)=>{
        const h = document.createElement('h2');
        h.className='ev-month';
        h.textContent = monthLabel(key);
        frag.appendChild(h);

        const grid = document.createElement('div');
        grid.className='ev-grid';

        groups[key].forEach((evt, idx)=>{
          const card = document.createElement('article');
          card.className='ev-card'; card.setAttribute('role','article');

          const img = document.createElement('img');
          img.src = evt.flyer || evt.full || '';
          img.alt = evt.title || 'Event flyer';
          img.loading='lazy';
          img.addEventListener('click', ()=>openLightbox(evt));

          const meta = document.createElement('div');
          meta.className='ev-meta';

          const t = document.createElement('h3'); t.className='ev-title'; t.textContent = evt.title || 'Event';
          const time = document.createElement('time'); time.className='ev-date'; if(evt._iso) time.setAttribute('datetime', evt._iso); time.textContent = evt._iso || (evt.date || 'TBA');
          const p = document.createElement('p'); p.className='ev-desc'; p.textContent = evt.description || '';

          meta.append(t, time, p);
          card.append(img, meta);

          card.style.opacity='0'; card.style.transform='translateY(8px)'; card.style.transition='opacity .3s ease, transform .3s ease';
          setTimeout(()=>{ card.style.opacity='1'; card.style.transform='none'; }, 70*idx);

          grid.appendChild(card);
        });

        frag.appendChild(grid);
      });

      if(!data.length){
        const p = document.createElement('p');
        p.textContent = 'No events yet. Check back soon.';
        frag.appendChild(p);
      }

      mount.appendChild(frag);

      // Lightbox
      const lb = document.getElementById('evLightbox');
      const lbImg = lb.querySelector('.ev-lightbox-img');
      const lbCap = lb.querySelector('.ev-lightbox-cap');
      const closeBtn = lb.querySelector('[data-ev-close]');

      function openLightbox(evt){
        lbImg.src = evt.full || evt.flyer || '';
        lbImg.alt = evt.title || '';
        lbCap.textContent = evt.title || '';
        lb.classList.add('open'); lb.setAttribute('aria-hidden','false');
      }
      function closeLightbox(){
        lb.classList.remove('open'); lb.setAttribute('aria-hidden','true');
        lbImg.src = ''; lbImg.alt=''; lbCap.textContent='';
      }
      closeBtn.addEventListener('click', closeLightbox);
      lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.classList.contains('open')) closeLightbox(); });
    })();
  </script>

  <!-- ===== Featured mini-carousel ===== -->
  <script>
    (function () {
      const wrap = document.getElementById('evFeaturedCard');
      if (!wrap) return;

      const imgEl   = wrap.querySelector('.ev-featured-media img');
      const dateEl  = document.getElementById('evFeaturedDate');
      const titleEl = document.getElementById('evFeaturedTitle');
      const descEl  = document.getElementById('evFeaturedDesc');
      const prevBtn = document.getElementById('evPrev');
      const nextBtn = document.getElementById('evNext');

      const toISO = d => {
        if (!d) return null;
        if (/^\d{4}-\d{2}-\d{2}$/.test(d)) return d;
        const t = new Date(d); if (isNaN(t)) return null;
        return [t.getFullYear(), String(t.getMonth()+1).padStart(2,'0'), String(t.getDate()).padStart(2,'0')].join('-');
      };

      const source = Array.isArray(window.EVENTS) && window.EVENTS.length ? window.EVENTS.map(e=>({ ...e, _iso: toISO(e.date) })) : [{
        title:'Meet the E-board', date:'2025-10-22',
        flyer:'images/Event photos/Executive Board Retreat 2025 1.jpeg',
        full :'images/Event photos/Executive Board Retreat 2025 1.jpeg',
        description:'Meet the new executive board and learn about upcoming events.', _iso:'2025-10-22'
      }];

      source.sort((a,b)=> (!a._iso) - (!b._iso) || a._iso?.localeCompare(b._iso));
      const today = new Date().toISOString().slice(0,10);
      let slides = source.filter(e => e._iso && e._iso >= today);
      if (!slides.length) slides = source;

      let i = 0;
      function render(idx, fade=true){
        const ev = slides[idx];
        const iso = ev._iso || ev.date || 'TBA';
        if (fade){
          wrap.classList.remove('fade-in'); wrap.classList.add('fade-out');
          setTimeout(()=>update(ev, iso), 140);
        } else {
          update(ev, iso);
        }
      }
      function update(ev, iso){
        imgEl.src = ev.full || ev.flyer || '';
        imgEl.alt = ev.title || 'Event flyer';
        dateEl.textContent = iso;
        titleEl.textContent = ev.title || 'Event';
        descEl.textContent  = ev.description || '';
        requestAnimationFrame(()=>{
          wrap.classList.remove('fade-out'); wrap.classList.add('fade-in');
          setTimeout(()=>wrap.classList.remove('fade-in'), 350);
        });
      }

      function next(){ i = (i + 1) % slides.length; render(i); }
      function prev(){ i = (i - 1 + slides.length) % slides.length; render(i); }

      nextBtn.addEventListener('click', next);
      prevBtn.addEventListener('click', prev);
      document.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); });

      let timer = setInterval(next, 6000);
      wrap.addEventListener('mouseenter', ()=>clearInterval(timer));
      wrap.addEventListener('mouseleave', ()=>timer=setInterval(next, 6000));

      render(i, false);
    })();
  </script>
</body>
</html>
